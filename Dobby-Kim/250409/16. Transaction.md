# Transaction


### 1. 트랜잭션(Transaction)이란 무엇인가?

- **정의:**  
  트랜잭션은 데이터베이스의 여러 연산(예: INSERT, UPDATE, DELETE 등)을 하나의 작업 단위로 묶은 것으로, 전체가 성공하면 커밋(commit), 중간에 오류가 발생하면 롤백(rollback)하여 이전 상태로 복구됨.

- **목적:**  
  데이터의 일관성과 무결성을 보장하기 위해, 여러 연산이 중간에 끊기지 않고 모두 반영되거나 전혀 반영되지 않아야 함.


---

### 2. 트랜잭션과 Lock

- **Lock의 역할:**

    - 트랜잭션은 여러 사용자나 프로세스가 동시에 같은 데이터를 처리할 때 발생할 수 있는 문제(경쟁 상태, 동시성 문제)를 방지하기 위해 잠금(Lock)을 사용.

    - **공유 잠금(Shared Lock):** 읽기 작업 시 다른 트랜잭션도 읽을 수 있도록 허용하지만, 쓰기 작업은 제한.

    - **배타적 잠금(Exclusive Lock):** 쓰기 작업 시 다른 트랜잭션이 해당 데이터를 읽거나 쓸 수 없도록 막는다.

- **동시성 제어:**  
  락을 통해 여러 트랜잭션이 동시에 작업할 때 데이터의 일관성을 유지하고, 충돌이나 충돌로 인한 이상 현상을 방지할 수 있다.


---

### 3. 트랜잭션의 특성 (ACID)

트랜잭션은 다음의 ACID 원칙을 준수.

- **Atomicity (원자성):**  
  트랜잭션 내의 모든 연산은 하나의 단위로 실행되며, 일부만 처리되거나 도중에 멈출 수 없다.

- **Consistency (일관성):**  
  트랜잭션이 완료되면 데이터베이스는 항상 일관된 상태를 유지해야 합니다. 트랜잭션 전후에 데이터베이스 규칙과 제약 조건이 항상 만족해야 함.

- **Isolation (격리성):**  
  동시에 실행되는 트랜잭션 간에는 서로 간섭이 없어야 하며, 각 트랜잭션은 독립적으로 실행되는 것처럼 보여야 합니다. 이때 Lock과 같은 메커니즘을 사용합.

- **Durability (지속성):**  
  커밋된 트랜잭션의 결과는 시스템 장애가 발생하더라도 영구적으로 데이터베이스에 반영.


---

### 4. 트랜잭션의 상태

트랜잭션은 실행되는 동안 여러 상태(state)를 거치게 된다.

- **Active (활성 상태):**  
  트랜잭션이 시작되어 연산이 수행되고 있는 상태.

- **Partially Committed (부분 커밋 상태):**  
  모든 연산이 실행되었지만, 아직 커밋하지 않은 상태로, 시스템 내부적으로 최종 결정을 기다리는 단계.

- **Committed (커밋 상태):**  
  모든 연산이 성공적으로 완료되어 데이터베이스에 반영되고, 변경 사항이 영구적으로 저장된 상태.

- **Failed (실패 상태):**  
  트랜잭션 실행 중에 오류가 발생하여 정상적으로 완료될 수 없는 상태.

- **Aborted (롤백 상태):**  
  오류 발생 후 트랜잭션이 취소되어 실행 이전의 상태로 복구된 상태.


---

### 5. 트랜잭션을 사용할 때 주의할 점

- **Deadlock (교착 상태):**  
  여러 트랜잭션이 서로의 락을 기다리면서 멈추게 될 수 있다. 이를 예방하기 위해서는 락의 순서를 정하거나 타임아웃을 설정함.

- **긴 트랜잭션:**  
  오랜 시간 동안 트랜잭션이 열려 있으면 락을 오래 보유하게 되어 다른 트랜잭션의 대기 시간이 증가하고, 성능 저하를 유발할 수 있다.

- **적절한 격리 수준 선택:**  
  트랜잭션 격리 수준(Read Uncommitted, Read Committed, Repeatable Read, Serializable)을 상황에 맞게 조절해야 하는데, 격리 수준이 높으면 동시성이 떨어질 수 있고, 낮으면 데이터 일관성에 위험이 있을 수 있다.

- **에러 처리:**  
  트랜잭션 내에서 문제가 발생했을 때 적절하게 롤백(rollback)을 처리하여 데이터베이스가 일관된 상태로 유지되도록 해야 함.


---

### 구어체 답안

트랜잭션은 데이터베이스에서 하나의 작업 단위를 말하는데요, 여러 연산을 하나로 묶어서 모두 성공하면 커밋하고, 중간에 문제가 생기면 전부 롤백하는 방식입니다. 이 덕분에 데이터의 일관성을 보장할 수 있죠. 그리고 트랜잭션은 동시 사용자가 같은 데이터를 접근할 때 충돌을 막기 위해 락을 사용하는데, 예를 들어 읽기 작업에는 공유 락, 쓰기 작업에는 배타적 락을 걸어 서로 간섭하지 못하게 합니다.

트랜잭션은 ACID 원칙, 즉 원자성, 일관성, 격리성, 지속성을 따르는데, 이는 각각 모든 연산이 하나의 단위로 처리되는 것, 데이터 규칙을 항상 만족하는 것, 다른 트랜잭션과 간섭 없이 독립적으로 실행되는 것, 커밋 이후에도 변경 사항이 영구적으로 반영되는 것을 의미합니다.

또한, 트랜잭션은 실행 중에 '활성 상태', '부분 커밋 상태', '커밋 상태', 그리고 오류가 발생하면 '실패' 또는 '롤백' 상태로 전환되는데요, 긴 트랜잭션이나 교착 상태 같은 문제를 예방하기 위해 적절한 격리 수준과 타임아웃 설정, 에러 처리 등 세심한 관리가 필요합니다
